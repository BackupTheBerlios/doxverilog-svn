<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>some preprocessing examples</title>

<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->

<div class="contents">
<h1><a class="anchor" name="page1">some preprocessing examples </a></h1><p>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<style type="text/css">
.pre {white-space: pre;}
.nowrap {white-space: nowrap;}
.pre-wrap {white-space: pre-wrap;}
.pre-line {white-space: pre-line;}
body, table, div, p, dl {
	font-family: Lucida Grande, Verdana, Geneva, Arial, sans-serif;
	font-size: 12px;
}

</style>

</head>
<body>

<p class="pre-line" style="border:1pt solid #ff0000">
#---------------------------------------------------------------------------
# Configuration options related to the preprocessor   
#---------------------------------------------------------------------------
 ENABLE_PREPROCESSING   = YES
 MACRO_EXPANSION        = NO
 EXPAND_ONLY_PREDEF     = 
 SEARCH_INCLUDES        =
 INCLUDE_PATH           = 
 INCLUDE_FILE_PATTERNS  = 
 PREDEFINED             =
 EXPAND_AS_DEFINED      = 
 SKIP_FUNCTION_MACROS   = YES

 ----------------------------------------------------------------------------
 -------- file def.v -------------------------------------------------------- 
 ----------------------------------------------------------------------------
 
// some definitions

`ifndef INCLUDE_DEF
`define INCLUDE_DEF

`define SLOW 

`ifdef FAST 
  `define fast_clk 100000000
`elsif SLOW_1 
  `define slow_clk 1000000
`elsif SLOW 
  `define slow_clk 1000000 
`endif 

`define SLOW_1 
 
 `ifdef FAST 
   `define fast_clk1 100000000
  `elsif SLOW_1
   `define slow_clk1 1000000
  `elsif SLOW 
   `define slow_clk1 1000000 
 `endif 


 `ifdef SLOW_1
  `ifndef SLOW
    `define slow_clk3 10000
      `else
    `define  slow_clk3 1000000
  `endif
 `endif 

`endif
</p>

<p> will be parsed ... </p>
</span>
<div class="fragment"><pre class="fragment">
<a name="l00001"></a>00001  <span class="keyword">// some definitions</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="preprocessor">`ifndef  INCLUDE_DEF </span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 
<a name="l00006"></a><a class="code" href="def_8v.html#3979645dc86b346495131ee8ff85550d">00006</a> <span class="preprocessor">`define</span> SLOW 
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="preprocessor">`ifdef FAST  </span>
<a name="l00009"></a>00009   <span class="undoc">define fast_clk 100000000</span>
<a name="l00010"></a>00010 <span class="undoc">`elsif SLOW_1 </span>
<a name="l00011"></a>00011   <span class="undoc">define slow_clk 1000000</span>
<a name="l00012"></a>00012 <span class="preprocessor">`elsif SLOW </span>
<a name="l00013"></a><a class="code" href="def_8v.html#998abfdd24f20517fb9f70d3aebaedae">00013</a>   <span class="preprocessor">`define</span> slow_clk <span class="vhdllogic">1000000</span> 
<a name="l00014"></a>00014 <span class="preprocessor">`endif </span>
<a name="l00015"></a>00015 
<a name="l00016"></a><a class="code" href="def_8v.html#1429fca8a0eae0389a08afcfe46cee29">00016</a> <span class="preprocessor">`define</span> SLOW_1 
<a name="l00017"></a>00017  
<a name="l00018"></a>00018  <span class="preprocessor">`ifdef FAST  </span>
<a name="l00019"></a>00019    <span class="undoc">define fast_clk1 100000000</span>
<a name="l00020"></a>00020   <span class="preprocessor">`elsif SLOW_1</span>
<a name="l00021"></a><a class="code" href="def_8v.html#6e00b15d932dcac7db299dad8fb302ef">00021</a>    <span class="preprocessor">`define</span> slow_clk1 <span class="vhdllogic">1000000</span>
<a name="l00022"></a>00022   <span class="undoc">`elsif SLOW </span>
<a name="l00023"></a>00023    <span class="undoc">define slow_clk1 1000000 </span>
<a name="l00024"></a>00024  <span class="preprocessor">`endif </span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 
<a name="l00027"></a>00027  <span class="preprocessor">`ifdef SLOW_1 </span>
<a name="l00028"></a>00028   <span class="preprocessor">`ifndef  SLOW </span>
<a name="l00029"></a>00029     <span class="undoc">define slow_clk3 10000</span>
<a name="l00030"></a>00030       <span class="preprocessor">`else</span>
<a name="l00031"></a><a class="code" href="def_8v.html#f8d8c28959c63488bb063ed1fd3aeba6">00031</a>     <span class="preprocessor">`define</span> slow_clk3 <span class="vhdllogic">1000000</span>
<a name="l00032"></a>00032   <span class="preprocessor">`endif</span>
<a name="l00033"></a>00033  <span class="preprocessor">`endif </span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">`endif</span></pre></div></div>

</body>
</html>
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<style type="text/css">
.pre {white-space: pre;}
.nowrap {white-space: nowrap;}
.pre-wrap {white-space: pre-wrap;}
.pre-line {white-space: pre-line;}

</style>
</head>
<body>
<p class="pre" style="border:1pt solid #ff0000">

#---------------------------------------------------------------------------
# Configuration options related to the preprocessor   
#---------------------------------------------------------------------------
ENABLE_PREPROCESSING   = YES
MACRO_EXPANSION        = yes
EXPAND_ONLY_PREDEF     = 
SEARCH_INCLUDES        =
INCLUDE_PATH           = 
INCLUDE_FILE_PATTERNS  = 
PREDEFINED             =
EXPAND_AS_DEFINED      = 

----------------------------------------------------------------------------
 
 `define CLOCK_16
  
  `ifdef CLOCK_16 
   `define SIZE 15
   `define CLOCK clock16
  `else
   `define SIZE 7
   `define CLOCK clock8
  `endif 
 
  `define STEP 1
  `define EMPTY

module `CLOCK( enable, clk, timeo );
   input enable, clk;
   output [`SIZE:0] timeo;
   reg [`SIZE:0] timeo;

   always @(posedge clk)
    begin:`EMPTY `CLOCK 
    if( enable ) 
      timeo=timeo+`STEP;
    end
endmodule
</p>


<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001  
<a name="l00002"></a>00002 
<a name="l00003"></a><a class="code" href="time__cnt_8v.html#fafe8ed69bfb8886bf9e8268a065fa20">00003</a>   <span class="preprocessor">`define</span> CLOCK_16
<a name="l00004"></a>00004   
<a name="l00005"></a>00005   <span class="preprocessor">`ifdef CLOCK_16  </span>
<a name="l00006"></a><a class="code" href="time__cnt_8v.html#961846e4828663be917f38b20ebc9fb1">00006</a>    <span class="preprocessor">`define</span> SIZE <span class="vhdllogic">15</span>
<a name="l00007"></a><a class="code" href="time__cnt_8v.html#49f475edcc92b116345eead38cd76cce">00007</a>    <span class="preprocessor">`define</span> CLOCK clock16
<a name="l00008"></a>00008   <span class="undoc">else</span>
<a name="l00009"></a>00009    <span class="undoc">define SIZE 7</span>
<a name="l00010"></a>00010    <span class="undoc">define CLOCK clock8</span>
<a name="l00011"></a>00011   <span class="preprocessor">`endif </span>
<a name="l00012"></a>00012  
<a name="l00013"></a><a class="code" href="time__cnt_8v.html#9f7aa4cbb494575de9f3836376396214">00013</a>   <span class="preprocessor">`define</span> STEP <span class="vhdllogic">1</span>
<a name="l00014"></a><a class="code" href="time__cnt_8v.html#17455b50e4032b2e0cdf3820076968b5">00014</a>   <span class="preprocessor">`define</span> EMPTY
<a name="l00015"></a>00015 
<a name="l00016"></a><a class="code" href="classclock16.html#13b5d6df78034913586beb2fd16393ff">00016</a> <span class="vhdlkeyword">module</span>  <a class="code" href="classclock16.html">clock16</a> ( <a class="code" href="classclock16.html#17d5dea31e6ccc361aa2918efc3ed82a">enable</a>, <a class="code" href="classclock16.html#5e7d04c48234912aff7e162c3d0202c2">clk</a>, <a class="code" href="classclock16.html#13b5d6df78034913586beb2fd16393ff">timeo</a> );
<a name="l00017"></a><a class="code" href="classclock16.html#88c60daa4eec5a4921fd568d0156f301">00017</a>    <span class="vhdlkeyword">input</span> <a class="code" href="classclock16.html#8cf12ac209b01ccb793bff7f93314034">enable</a>, <a class="code" href="classclock16.html#88c60daa4eec5a4921fd568d0156f301">clk</a>;
<a name="l00018"></a><a class="code" href="classclock16.html#56f0e1273c684a88db1ea0310d1b0bb2">00018</a>    <span class="vhdlkeyword">output</span> [ <span class="vhdllogic">15</span> :<span class="vhdllogic">0</span>] <a class="code" href="classclock16.html#56f0e1273c684a88db1ea0310d1b0bb2">timeo</a>;
<a name="l00019"></a><a class="code" href="classclock16.html#10a1e04e1d8ac5327cbf8f3e7d33be85">00019</a>    <span class="vhdlkeyword">reg</span> [ <span class="vhdllogic">15</span> :<span class="vhdllogic">0</span>] <a class="code" href="classclock16.html#13b5d6df78034913586beb2fd16393ff">timeo</a>;
<a name="l00020"></a>00020 
<a name="l00021"></a><a class="code" href="classclock16.html#1f653df3d263253b5c4fe91b3d8cc48d">00021</a>    <span class="vhdlkeyword">always</span> @(<span class="vhdlkeyword">posedge</span> <a class="code" href="classclock16.html#5e7d04c48234912aff7e162c3d0202c2">clk</a>)
<a name="l00022"></a>00022     <span class="vhdlkeyword">begin</span>:    <a class="code" href="classclock16.html">clock16</a>  
<a name="l00023"></a>00023     <span class="vhdlkeyword">if</span>( <a class="code" href="classclock16.html#17d5dea31e6ccc361aa2918efc3ed82a">enable</a> ) 
<a name="l00024"></a>00024       <a class="code" href="classclock16.html#13b5d6df78034913586beb2fd16393ff">timeo</a>=<a class="code" href="classclock16.html#13b5d6df78034913586beb2fd16393ff">timeo</a>+ <span class="vhdllogic">1</span> ;
<a name="l00025"></a>00025     <span class="vhdlkeyword">end</span>
<a name="l00026"></a>00026 <span class="vhdlkeyword">endmodule</span>
<a name="l00027"></a>00027 
</pre></div></div>
</body>
</html>
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<style type="text/css">
.pre {white-space: pre;}
.nowrap {white-space: nowrap;}
.pre-wrap {white-space: pre-wrap;}
.pre-line {white-space: pre-line;}

</style>
</head>
<body>
<p> When  <b>SEARCH_INCLUDES=yes </b> the parser evaluates
   the `inlcude "xxx.v" files at first.
   Here is one example
</p>
<p class="pre" style="border:1pt solid #ff0000">
#---------------------------------------------------------------------------
# Configuration options related to the preprocessor   
#---------------------------------------------------------------------------
ENABLE_PREPROCESSING   = YES
MACRO_EXPANSION        = yes
EXPAND_ONLY_PREDEF     = 
SEARCH_INCLUDES        = yes
INCLUDE_PATH           = 
INCLUDE_FILE_PATTERNS  = 
PREDEFINED             =
EXPAND_AS_DEFINED      = 
SKIP_FUNCTION_MACROS   = YES

//--------- file dev_timer.v -----------------

`ifndef TIMER_H
`define TIMER_H

  `define CLOCK_16
  
  `ifdef CLOCK_16 
   `define SIZE 15
   `define CLOCK clock16
  `else
   `define SIZE 7
   `define CLOCK clock8
  `endif 
 
  `define STEP 1
  `define EMPTY
`endif

//--------- file timer.v -----------------

`include "dev_timer.v"

module `CLOCK( enable, clk, timeo );
   input enable, clk;
   output [`SIZE:0] timeo;
   reg [`SIZE:0] timeo;

   always @(posedge clk)
    begin:`EMPTY `CLOCK 
    if( enable ) 
      timeo=timeo+`STEP;
    end
endmodule
</P>


<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001  
<a name="l00002"></a><a class="code" href="time__cnt_8v.html#c18cdbf2bf2800ad0a8e5177beeb8590">00002</a> <span class="preprocessor">`include "dev_timer.v"</span>
<a name="l00003"></a>00003 
<a name="l00004"></a><a class="code" href="classclock16.html#13b5d6df78034913586beb2fd16393ff">00004</a> <span class="vhdlkeyword">module</span>  <a class="code" href="classclock16.html">clock16</a> ( <a class="code" href="classclock16.html#17d5dea31e6ccc361aa2918efc3ed82a">enable</a>, <a class="code" href="classclock16.html#5e7d04c48234912aff7e162c3d0202c2">clk</a>, <a class="code" href="classclock16.html#13b5d6df78034913586beb2fd16393ff">timeo</a> );
<a name="l00005"></a><a class="code" href="classclock16.html#88c60daa4eec5a4921fd568d0156f301">00005</a>    <span class="vhdlkeyword">input</span> <a class="code" href="classclock16.html#8cf12ac209b01ccb793bff7f93314034">enable</a>, <a class="code" href="classclock16.html#88c60daa4eec5a4921fd568d0156f301">clk</a>;
<a name="l00006"></a><a class="code" href="classclock16.html#56f0e1273c684a88db1ea0310d1b0bb2">00006</a>    <span class="vhdlkeyword">output</span> [ <span class="vhdllogic">15</span> :<span class="vhdllogic">0</span>] <a class="code" href="classclock16.html#56f0e1273c684a88db1ea0310d1b0bb2">timeo</a>;
<a name="l00007"></a><a class="code" href="classclock16.html#10a1e04e1d8ac5327cbf8f3e7d33be85">00007</a>    <span class="vhdlkeyword">reg</span> [ <span class="vhdllogic">15</span> :<span class="vhdllogic">0</span>] <a class="code" href="classclock16.html#13b5d6df78034913586beb2fd16393ff">timeo</a>;
<a name="l00008"></a>00008 
<a name="l00009"></a><a class="code" href="classclock16.html#1f653df3d263253b5c4fe91b3d8cc48d">00009</a>    <span class="vhdlkeyword">always</span> @(<span class="vhdlkeyword">posedge</span> <a class="code" href="classclock16.html#5e7d04c48234912aff7e162c3d0202c2">clk</a>)
<a name="l00010"></a>00010     <span class="vhdlkeyword">begin</span>:    <a class="code" href="classclock16.html">clock16</a>  
<a name="l00011"></a>00011     <span class="vhdlkeyword">if</span>( <a class="code" href="classclock16.html#17d5dea31e6ccc361aa2918efc3ed82a">enable</a> ) 
<a name="l00012"></a>00012       <a class="code" href="classclock16.html#13b5d6df78034913586beb2fd16393ff">timeo</a>=<a class="code" href="classclock16.html#13b5d6df78034913586beb2fd16393ff">timeo</a>+ <span class="vhdllogic">1</span> ;
<a name="l00013"></a>00013     <span class="vhdlkeyword">end</span>
<a name="l00014"></a>00014 <span class="vhdlkeyword">endmodule</span>
<a name="l00015"></a>00015 
</pre></div></div>

</body>
</html>
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<style type="text/css">
.pre {white-space: pre;}
.nowrap {white-space: nowrap;}
.pre-wrap {white-space: pre-wrap;}
.pre-line {white-space: pre-line;}

</style>
</head>
<body>
<p> When <b>EXPAND_ONLY_PREDEF=yes</b> only the defined macros in verilog.cfg are replaced in clock.v </p>
<p class="pre" style="border:1pt solid #ff0000">

#----------------------verilog.cfg -----------------------------------------
# Configuration options related to the preprocessor   
#---------------------------------------------------------------------------
ENABLE_PREPROCESSING   = yes
MACRO_EXPANSION        = yes
EXPAND_ONLY_PREDEF     = yes
SEARCH_INCLUDES        = no
INCLUDE_PATH           = 
INCLUDE_FILE_PATTERNS  = 
PREDEFINED             = "CLOCK= clock16"\
                       = "EMPTY=\"
                       = "STEP= 1"

EXPAND_AS_DEFINED      = 
SKIP_FUNCTION_MACROS   = YES


------------clock.v ---------------------------------------------------------

`define SIZE 8

module `CLOCK( enable, clk, timeo );
   input enable, clk;
   output [`SIZE:0] timeo;
   reg [`SIZE:0] timeo;

   always @(posedge clk)
    begin:`EMPTY `CLOCK 
    if( enable ) 
      timeo=timeo+`STEP;
    end
endmodule
</p>


<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001  
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 
<a name="l00004"></a><a class="code" href="time__cnt1_8v.html#53eb84a79ad8c2b5711df4fe58081d95">00004</a> <span class="preprocessor">`define</span> SIZE <span class="vhdllogic">15</span>
<a name="l00005"></a>00005 
<a name="l00006"></a><a class="code" href="classclock16.html#13b5d6df78034913586beb2fd16393ff">00006</a> <span class="vhdlkeyword">module</span>  <a class="code" href="classclock16.html">clock16</a> ( <a class="code" href="classclock16.html#17d5dea31e6ccc361aa2918efc3ed82a">enable</a>, <a class="code" href="classclock16.html#5e7d04c48234912aff7e162c3d0202c2">clk</a>, <a class="code" href="classclock16.html#13b5d6df78034913586beb2fd16393ff">timeo</a> );
<a name="l00007"></a><a class="code" href="classclock16.html#88c60daa4eec5a4921fd568d0156f301">00007</a>    <span class="vhdlkeyword">input</span> <a class="code" href="classclock16.html#8cf12ac209b01ccb793bff7f93314034">enable</a>, <a class="code" href="classclock16.html#88c60daa4eec5a4921fd568d0156f301">clk</a>;
<a name="l00008"></a><a class="code" href="classclock16.html#7c0e3eb400743263ca574ee317e56961">00008</a>    <span class="vhdlkeyword">output</span> [<a class="code" href="time__cnt1_8v.html#46cf1690751efa02c61be80439b32dfa">`SIZE</a><span class="vhdlchar"></span>:<span class="vhdllogic">0</span>] <a class="code" href="classclock16.html#7c0e3eb400743263ca574ee317e56961">timeo</a>;
<a name="l00009"></a><a class="code" href="classclock16.html#216f957a96da83a04debb82a41b37193">00009</a>    <span class="vhdlkeyword">reg</span> [<a class="code" href="time__cnt1_8v.html#46cf1690751efa02c61be80439b32dfa">`SIZE</a><span class="vhdlchar"></span>:<span class="vhdllogic">0</span>] <a class="code" href="classclock16.html#13b5d6df78034913586beb2fd16393ff">timeo</a>;
<a name="l00010"></a>00010 
<a name="l00011"></a><a class="code" href="classclock16.html#1f653df3d263253b5c4fe91b3d8cc48d">00011</a>    <span class="vhdlkeyword">always</span> @(<span class="vhdlkeyword">posedge</span> <a class="code" href="classclock16.html#5e7d04c48234912aff7e162c3d0202c2">clk</a>)
<a name="l00012"></a>00012     <span class="vhdlkeyword">begin</span>:    <a class="code" href="classclock16.html">clock16</a>  
<a name="l00013"></a>00013     <span class="vhdlkeyword">if</span>( <a class="code" href="classclock16.html#17d5dea31e6ccc361aa2918efc3ed82a">enable</a> ) 
<a name="l00014"></a>00014       <a class="code" href="classclock16.html#13b5d6df78034913586beb2fd16393ff">timeo</a>=<a class="code" href="classclock16.html#13b5d6df78034913586beb2fd16393ff">timeo</a>+ <span class="vhdllogic">1</span> ;
<a name="l00015"></a>00015     <span class="vhdlkeyword">end</span>
<a name="l00016"></a>00016 <span class="vhdlkeyword">endmodule</span>
<a name="l00017"></a>00017 
</pre></div></div>
 
<p> Till now code lines with macros like `define,`endif,`else must start with a macro. No  
    further code construct is allowed in the same line    
<p class="pre" style="border:1pt solid #ff0000">
`ifdef SIMULATION
 if (i_rst) begin
 sreg0 <= 16'h0000;
 <b>end else `endif if (i_clk_en) begin</b>
</p>
<p> must be rewritten in ... </p>
<p class="pre" style="border:1pt solid #ff0000">
`ifdef SIMULATION
 if (i_rst) begin
 sreg0 <= 16'h0000;
 <b>end else 
 <b> `endif </b>
  if (i_clk_en) begin
</p>


</body>
</html>
 </div>
</body>
</html>
